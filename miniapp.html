<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏</title>
</head>
<body>
  <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã</h2>
  <p id="status">‚è≥ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</p>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const user = tg.initDataUnsafe?.user;
    const contestId = new URLSearchParams(window.location.search).get("contest_id");

    if (!user) {
      document.getElementById("status").innerText = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram.";
    } else {
      document.getElementById("status").innerText = "üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏...";

      fetch("https://YOUR_SERVER/api/check_subscription", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          user_id: user.id,
          username: user.username || "",
          contest_id: contestId
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById("status").innerText = "‚úÖ –í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –∫–æ–Ω–∫—É—Ä—Å–µ!";
        } else {
          document.getElementById("status").innerText = "‚ùå " + data.message;
        }
      })
      .catch(err => {
        document.getElementById("status").innerText = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞.";
        console.error(err);
      });
    }
  </script>
</body>
</html>
